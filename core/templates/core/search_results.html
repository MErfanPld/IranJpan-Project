{% extends "_master.html" %}
{% load static %}

{% block title %}نتایج جستجو{% endblock title %}

{% block contents %}
        <!-- Start Page Banner -->
        <div class="page-title-area">
            <div class="container">
                <div class="page-title-content">
                    <h2>نتایج جستجو</h2>
                    <ul>
                        <li><a href="{% url "core:home" %}">خانه</a></li>
                        <li>نتایج جستجو</li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- End Page Banner -->

        <!-- Start Search Results Area -->
        <section class="news-area bg-ffffff ptb-50">
            <div class="container">
                <div class="row">
                    <!-- Sidebar -->
                    <div class="col-lg-4">
                        <aside class="widget-area">
                            <section class="widget widget_search">
                                <h3 class="widget-title">جستجو</h3>
                                <form method="get" action="{% url 'core:search_results' %}" class="search-form" style="display:flex; flex-direction:column; gap:10px;">
                                    <div style="position: relative; width: 100%;">
                                        <input type="text" name="q" class="form-control" placeholder="جستجو..." value="{{ request.GET.q }}" 
                                            style="width:100%; padding-right: 40px; box-sizing: border-box;">
                                        <button type="submit" style="position:absolute; top:0; right:0; height:100%; border:none; background:#df1c22; color:#fff; padding:0 15px; cursor:pointer;">
                                            <i class='bx bx-search'></i>
                                        </button>
                                    </div>
                                </form>
                            </section>

                            <!-- دسته بندی ها -->
                            <section class="widget widget_tag_cloud">
                                <h3 class="widget-title">دسته بندی ها</h3>
                                <div class="tagcloud">
                                    {% for category in cats %}
                                        <a href="{% url 'blog:category_blog' category.slug %}">
                                            {{ category.title }}
                                        </a>
                                    {% empty %}
                                        <span>دسته بندی وجود ندارد</span>
                                    {% endfor %}
                                </div>
                            </section>

                            <!-- برچسب ها -->
                            <section class="widget widget_tag_cloud">
                                <h3 class="widget-title">برچسب‌ها</h3>
                                <div class="tagcloud">
                                    {% for tag in tags %}
                                        <a href="{% url 'blog:tag_blog' tag.slug %}">
                                            {{ tag.title }}
                                        </a>
                                    {% empty %}
                                        <span>برچسبی وجود ندارد</span>
                                    {% endfor %}
                                </div>
                            </section>

                            <!-- پست‌های محبوب -->
                            <section class="widget widget_popular_posts_thumb">
                                <h3 class="widget-title">پست‌های محبوب</h3>
                                {% for article in popular_articles %}
                                    <article class="item">
                                        <a href="{{ article.get_absolute_url }}" class="thumb">
                                            {% if article.image %}
                                                <span class="fullimage cover"
                                                    style="background-image:url('{{ article.image.url }}')"
                                                    role="img"></span>
                                            {% endif %}
                                        </a>
                                        <div class="info">
                                            <h4 class="title usmall">
                                                <a href="{{ article.get_absolute_url }}">
                                                    {{ article.title }}
                                                </a>
                                            </h4>
                                            <span>{{ article.jcreated_at|date:"d M Y" }}</span>
                                        </div>
                                    </article>
                                {% endfor %}
                            </section>
                        </aside>
                    </div>

                    <!-- نتایج جستجو -->
                    <div class="col-lg-8">
                        {% if articles %}
                            <h3>نتایج جستجو برای: "{{ request.GET.q }}"</h3>
                            <hr>
                            {% for article in articles %}
                                <div class="single-news-item">
                                    <div class="row align-items-center">
                                        <div class="col-lg-4">
                                            <div class="news-image">
                                                <a href="{{ article.get_absolute_url }}">
                                                    {% if article.image %}
                                                        <img src="{{ article.image.url }}" alt="{{ article.title }}">
                                                    {% else %}
                                                        <img src="{% static 'img/no-image.jpg' %}" alt="بدون تصویر">
                                                    {% endif %}
                                                </a>
                                            </div>
                                        </div>

                                        <div class="col-lg-8">
                                            <div class="news-content">
                                                <span>{{ article.category }}</span>
                                                <h3>
                                                    <a href="{{ article.get_absolute_url }}">{{ article.title }}</a>
                                                </h3>
                                                <p>{{ article.body|truncatechars:150|safe }}</p>
                                                <p><a href="#">{{ article.author }}</a> / {{ article.jcreated_at }}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}

                            {% if is_paginated %}
                                <div class="pagination-area">
                                    {% if page_obj.has_previous %}
                                        <a href="?q={{ request.GET.q }}&page={{ page_obj.previous_page_number }}" class="prev page-numbers">
                                            <i class='bx bx-chevron-left'></i>
                                        </a>
                                    {% endif %}

                                    {% for page in paginator.page_range %}
                                        {% if page == page_obj.number %}
                                            <span class="page-numbers current">{{ page }}</span>
                                        {% else %}
                                            <a href="?q={{ request.GET.q }}&page={{ page }}" class="page-numbers">{{ page }}</a>
                                        {% endif %}
                                    {% endfor %}

                                    {% if page_obj.has_next %}
                                        <a href="?q={{ request.GET.q }}&page={{ page_obj.next_page_number }}" class="next page-numbers">
                                            <i class='bx bx-chevron-right'></i>
                                        </a>
                                    {% endif %}
                                </div>
                            {% endif %}

                        {% else %}
                            <h3>هیچ نتیجه‌ای برای "{{ request.GET.q }}" یافت نشد.</h3>
                        {% endif %}
                    </div>

                </div>
            </div>
        </section>
        <!-- End Search Results Area -->

{% endblock contents %}
